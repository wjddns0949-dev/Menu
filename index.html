<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë©”ë‰´ ë£°ë ›</title>

  <!-- ë°˜ì‘í˜• ë·°í¬íŠ¸ -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description" content="ë©”ë‰´ ë£°ë › - ë­ ë¨¹ì„ì§€ ê³ ë¯¼ë  ë•Œ ëŒ€ì‹  ê³¨ë¼ì£¼ëŠ” ì¶”ì²œ ë£°ë › ì•±" />

  <!-- PWA: manifest & theme-color & icons -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#f97316" />
  <link rel="icon" type="image/png" href="icon.png" />
  <link rel="apple-touch-icon" href="icon.png" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ë©”ë‰´ ë£°ë ›" />
  <meta property="og:description" content="ë­ ë¨¹ì„ì§€, ë­ í• ì§€ ëŒ€ì‹  ê³¨ë¼ì£¼ëŠ” Menu Roulette Recommendation App" />
  <meta property="og:image" content="og_image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://wjddns0949-dev.github.io/Menu/" />

  <!-- Twitter ì¹´ë“œ (ì˜µì…˜) -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ë©”ë‰´ ë£°ë ›" />
  <meta name="twitter:description" content="ë­ ë¨¹ì„ì§€, ë­ í• ì§€ ëŒ€ì‹  ê³¨ë¼ì£¼ëŠ” Menu Roulette Recommendation App" />
  <meta name="twitter:image" content="og_image.png" />

  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f9;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #333;
    }

    .app {
      background: #ffffff;
      padding: 20px 16px 24px;
      border-radius: 18px;
      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(0,0,0,0.03);
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 22px;
      font-weight: 700;
      cursor: pointer;
    }

    .subtitle {
      font-size: 13px;
      color: #777;
      margin-bottom: 18px;
    }

    /* ì™¼ìª½: ì„¤ì • ì˜ì—­ */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .label {
      font-size: 13px;
      font-weight: 600;
      color: #444;
      margin-bottom: 4px;
    }

    textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      line-height: 1.5;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease;
    }

    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.2);
    }

    .hint {
      font-size: 12px;
      color: #999;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: #6366f1;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 6px 14px rgba(99,102,241,0.35);
      transition:
        transform 0.1s ease,
        box-shadow 0.1s ease,
        background 0.15s ease,
        opacity 0.15s ease;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    button:not(:disabled):active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 2px 7px rgba(99,102,241,0.3);
    }

    .reset-btn {
      background: transparent;
      color: #666;
      box-shadow: none;
      padding-inline: 14px;
    }

    .reset-btn:hover {
      background: #f3f4ff;
    }

    .result-box {
      margin-top: 16px;
      padding: 14px 14px;
      border-radius: 12px;
      background: #fafafa;
      border: 1px dashed #e1e1e1;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .result-label {
      font-size: 12px;
      color: #777;
    }

    .result-value {
      font-size: 18px;
      font-weight: 700;
      color: #111827;
    }

    /* ì˜¤ë¥¸ìª½: ë£°ë › ì˜ì—­ */
    .wheel-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .wheel-wrapper {
      position: relative;
      width: min(320px, 85vw);
      aspect-ratio: 1 / 1;
    }

    .wheel-svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* í¬ì¸í„° (ìœ„ìª½ ì‚¼ê°í˜•) */
    .pointer {
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 24px solid #f97316; /* ì£¼í™©ìƒ‰ í¬ì¸í„° */
      filter: drop-shadow(0 3px 3px rgba(0,0,0,0.2));
      z-index: 2;
    }

    .pointer::after {
      content: "";
      position: absolute;
      top: 9px;
      left: -10px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
    }

    /* SVG ìŠ¤íƒ€ì¼ */
    .wheel-bg {
      fill: #f9fafb;
    }

    .slice {
      stroke: #ffffff;
      stroke-width: 2;
      cursor: pointer;
    }

    .center-dot {
      fill: #111827;
    }

    .slice-label {
      font-size: 12px;
      fill: #111827;
      pointer-events: none;
      user-select: none;
    }

    .wheel-caption {
      font-size: 13px;
      color: #6b7280;
      text-align: center;
    }

    /* í­ì£½(ì»¨í˜í‹°) íš¨ê³¼ */
    #confetti-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: visible;
      z-index: 999;
    }

    .confetti-piece {
      position: absolute;
      width: 8px;
      height: 14px;
      border-radius: 2px;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ì™¼ìª½: ë©”ë‰´ ì„¤ì • -->
    <div class="controls">
      <div>
        <h1 id="roulette-title">ë©”ë‰´ ë£°ë › ğŸ²</h1>
        <div class="subtitle">ë©”ë‰´ë¥¼ ì…ë ¥í•˜ê³  ë£°ë ›ì„ ëŒë ¤ì„œ ì˜¤ëŠ˜ì˜ ì„ íƒì„ ì •í•´ë³´ì„¸ìš”!</div>
      </div>

      <div>
        <div class="label">ë©”ë‰´ ëª©ë¡ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</div>
        <textarea id="menu-input" spellcheck="false"></textarea>
        <div class="hint">
          ì˜ˆì‹œ) ê¹€ì¹˜ì°Œê°œâ†µë¹„ë¹”ë°¥â†µëˆê¹ŒìŠ¤â†µë¼ë©´ â€¦
        </div>
      </div>

      <div class="actions">
        <button id="spin-btn">
          <span>ë£°ë › ëŒë¦¬ê¸°</span> <span>âš¡</span>
        </button>
        <button id="reset-btn" class="reset-btn" type="button">ê¸°ë³¸ ë©”ë‰´ë¡œ ë˜ëŒë¦¬ê¸°</button>
      </div>

      <div class="result-box">
        <span class="result-label">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë©”ë‰´</span>
        <span id="result-text" class="result-value">ì•„ì§ ë£°ë ›ì„ ëŒë¦¬ì§€ ì•Šì•˜ì–´ìš”</span>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë£°ë › -->
    <div class="wheel-container">
      <div class="wheel-wrapper">
        <div class="pointer"></div>

        <!-- SVG ë£°ë › -->
        <svg id="wheel" class="wheel-svg" viewBox="-150 -150 300 300">
          <!-- ì „ì²´ ê·¸ë£¹ì„ íšŒì „ì‹œí‚¨ë‹¤ -->
          <g id="wheel-group">
            <!-- ë°”íƒ• ì› -->
            <circle class="wheel-bg" r="148"></circle>
            <!-- íŒŒì´ ì¡°ê°ë“¤ -->
            <g id="slices"></g>
            <!-- ì¤‘ì•™ ì  -->
            <circle class="center-dot" r="6"></circle>
          </g>
        </svg>
      </div>
      <div class="wheel-caption">
        í¬ì¸í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ë©”ë‰´ê°€ ì˜¤ëŠ˜ì˜ ì„ íƒì´ì—ìš” ğŸ½ï¸
      </div>
    </div>
  </div>

  <div id="confetti-container"></div>

  <script>
    const menuInput = document.getElementById("menu-input");
    const spinBtn   = document.getElementById("spin-btn");
    const resetBtn  = document.getElementById("reset-btn");
    const resultText = document.getElementById("result-text");
    const confettiContainer = document.getElementById("confetti-container");
    const rouletteTitle = document.getElementById("roulette-title");
    const defaultTitleText = "ë©”ë‰´ ë£°ë ›";
    const titleEmoji = " ğŸ²";
    let currentTitle = defaultTitleText;

    function applyTitle(title) {
      currentTitle = title && title.length > 0 ? title : defaultTitleText;
      if (rouletteTitle) {
        rouletteTitle.textContent = currentTitle + titleEmoji;
      }
      document.title = currentTitle;
    }

    applyTitle(currentTitle);

    if (rouletteTitle) {
      rouletteTitle.addEventListener("click", () => {
        const next = prompt("ë£°ë › ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ìš°ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤)", currentTitle);
        if (next === null) return;
        applyTitle(next.trim());
      });
    }

    const wheelGroup = document.getElementById("wheel-group");
    const slicesGroup = document.getElementById("slices");

    // ê¸°ë³¸ ë©”ë‰´
    const defaultMenus = [
      "ê¹€ì¹˜ì°Œê°œ",
      "ëœì¥ì°Œê°œ",
      "ë¹„ë¹”ë°¥",
      "ëˆê¹ŒìŠ¤",
      "ë¼ë©´",
      "í–„ë²„ê±°",
      "ì´ˆë°¥",
      "ìƒëŸ¬ë“œ"
    ];

    // í…ìŠ¤íŠ¸ì— ê¸°ë³¸ ë©”ë‰´ ì„¸íŒ…
    function setDefaultMenus() {
      menuInput.value = defaultMenus.join("\n");
    }
    setDefaultMenus();

    // ë¬¸ìì—´ ì…ë ¥ â†’ ë°°ì—´ë¡œ ë³€í™˜
    function getMenusFromInput() {
      return menuInput.value
        .split(/\n+/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    // ë£°ë › SVG íŒŒì´ ì¡°ê° ë§Œë“¤ê¸°
    function buildWheel(labels) {
      slicesGroup.innerHTML = ""; // ì´ì „ ì¡°ê° ì œê±°

      const count = labels.length;
      if (count === 0) return;

      const radius = 140;
      const angleStep = 360 / count;

      for (let i = 0; i < count; i++) {
        const startAngle = -90 + i * angleStep;
        const endAngle   = startAngle + angleStep;

        const startRad = (Math.PI / 180) * startAngle;
        const endRad   = (Math.PI / 180) * endAngle;

        const x1 = radius * Math.cos(startRad);
        const y1 = radius * Math.sin(startRad);
        const x2 = radius * Math.cos(endRad);
        const y2 = radius * Math.sin(endRad);

        const largeArcFlag = angleStep > 180 ? 1 : 0;

        const pathData = [
          `M 0 0`,
          `L ${x1} ${y1}`,
          `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
          `Z`
        ].join(" ");

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", pathData);
        path.setAttribute("class", "slice");

        // ìƒ‰ìƒ: HSLì„ ì´ìš©í•´ ì¡°ê°ë§ˆë‹¤ ë‹¤ë¥¸ ìƒ‰ ì§€ì •
        const hue = (i * (360 / count)) % 360;
        path.style.fill = `hsl(${hue}, 75%, 72%)`;

        slicesGroup.appendChild(path);

        // í…ìŠ¤íŠ¸(ì¡°ê° ì¤‘ì•™)
        const centerAngle = startAngle + angleStep / 2;
        const centerRad = (Math.PI / 180) * centerAngle;
        const textRadius = radius * 0.6;
        const tx = textRadius * Math.cos(centerRad);
        const ty = textRadius * Math.sin(centerRad);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", tx);
        text.setAttribute("y", ty);
        text.setAttribute("class", "slice-label");
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("dominant-baseline", "middle");
        text.textContent = labels[i];

        slicesGroup.appendChild(text);
      }

      // íšŒì „ê°’ ì´ˆê¸°í™”
      gsap.set(wheelGroup, { rotation: 0, svgOrigin: "0 0" });
    }

    // ì²˜ìŒ í•œ ë²ˆ ê¸°ë³¸ ë©”ë‰´ë¡œ ë£°ë › ìƒì„±
    buildWheel(defaultMenus);

    function fireConfetti() {
      const colors = ["#f97316", "#facc15", "#22c55e", "#0ea5e9", "#6366f1", "#ec4899"];
      const pieces = 140;

      for (let i = 0; i < pieces; i++) {
        const piece = document.createElement("div");
        piece.className = "confetti-piece";

        const color = colors[Math.floor(Math.random() * colors.length)];
        const startX = Math.random() * window.innerWidth;
        const startY = -20 - Math.random() * 80;

        confettiContainer.appendChild(piece);

        gsap.set(piece, {
          x: startX,
          y: startY,
          backgroundColor: color,
          opacity: 1,
          rotation: gsap.utils.random(-90, 90)
        });

        gsap.to(piece, {
          duration: gsap.utils.random(1.8, 2.6),
          y: window.innerHeight + 40,
          x: startX + gsap.utils.random(-120, 120),
          rotation: gsap.utils.random(-720, 720),
          ease: "power2.out",
          delay: gsap.utils.random(0, 0.25),
          onComplete: () => piece.remove()
        });
      }
    }

    // ë£°ë › ëŒë¦¬ê¸°
    function spinWheel() {
      const menus = getMenusFromInput();

      if (menus.length === 0) {
        alert("ìµœì†Œ 1ê°œ ì´ìƒì˜ ë©”ë‰´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
        return;
      }

      // ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ê°€ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ë‹¤ì‹œ ë£°ë › ìƒì„±
      buildWheel(menus);

      const count = menus.length;
      const angleStep = 360 / count;

      // ëœë¤ìœ¼ë¡œ ì„ íƒí•  ì¸ë±ìŠ¤
      const index = Math.floor(Math.random() * count);
      const selectedMenu = menus[index];

      // í¬ì¸í„°ëŠ” -90ë„(ìœ„ìª½) ë°©í–¥ì„ ê°€ë¦¬í‚¨ë‹¤ê³  ê°€ì •
      // index ë²ˆì§¸ ì¡°ê°ì˜ ì¤‘ì•™ ê°ë„ = -90 + angleStep * (index + 0.5)
      // ê·¸ ì¤‘ì•™ ê°ë„ê°€ í¬ì¸í„°(-90ë„)ì™€ ì¼ì¹˜í•˜ë„ë¡ íšŒì „ì‹œí‚¨ë‹¤.
      const baseRotation = -angleStep * (index + 0.5);

      // ì—¬ëŸ¬ ë°”í€´ë¥¼ ëŒê²Œ í•˜ê¸° ìœ„í•´ 3~5ë°”í€´ ì¶”ê°€
      const extraTurns = 3 + Math.floor(Math.random() * 3); // 3,4,5
      const targetRotation = baseRotation + 360 * extraTurns;

      // ë²„íŠ¼ ë¹„í™œì„±í™”
      spinBtn.disabled = true;

      // GSAP ì• ë‹ˆë©”ì´ì…˜ (ì„œì„œíˆ ì†ë„ ì¤„ì–´ë“œëŠ” ease)
      gsap.to(wheelGroup, {
        rotation: targetRotation,
        duration: 4.5,
        ease: "power3.out",
        svgOrigin: "0 0",
        onComplete: () => {
          resultText.textContent = selectedMenu;

          // ê²°ê³¼ í…ìŠ¤íŠ¸ íŠ€ì–´ë‚˜ì˜¤ëŠ” ì• ë‹ˆë©”ì´ì…˜
          gsap.fromTo(
            resultText,
            { scale: 0.6, opacity: 0 },
            { scale: 1, opacity: 1, duration: 0.45, ease: "back.out(2)" }
          );

          // í­ì£½ íš¨ê³¼ ë°œì‚¬
          fireConfetti();

          spinBtn.disabled = false;
        }
      });
    }

    spinBtn.addEventListener("click", spinWheel);

    resetBtn.addEventListener("click", () => {
      setDefaultMenus();
      buildWheel(defaultMenus);
      resultText.textContent = "ì•„ì§ ë£°ë ›ì„ ëŒë¦¬ì§€ ì•Šì•˜ì–´ìš”";
    });

    // PWA: ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("./sw.js")
          .catch((err) => {
            console.error("ServiceWorker registration failed:", err);
          });
      });
    }
  </script>
</body>
</html>
